
pipeline {
    agent any
    stages {
        stage("pem update premissions") {
            steps {
                sh """
                  chmod 600 /var/jenkins_home/secrets/testing.pem
                  chown jenkins:jenkins /var/jenkins_home/secrets/testing.pem
                  """
            }
       }
        stage("k8s update") {
            steps {
                echo "====++++executing A++++===="
                sh "ssh -i /var/jenkins_home/secrets/testing.pem ubuntu@3.70.39.129 kubectl get svc"
                sh """
                    ssh -i /var/jenkins_home/secrets/testing.pem ubuntu@3.70.39.129 kubectl patch svc kubernetes -p '{"spec": {"externalIPs": ["10.96.0.1"]}}'
                """
                sh "ssh -i /var/jenkins_home/secrets/testing.pem ubuntu@3.70.39.129 kubectl get svc"
                sh "pwd"
            }    
        }
    }
}